"use strict";angular.module("givitApp",["ngCookies","ngResource","ngSanitize","ngRoute","ngStorage","toggle-switch","akoenig.deckgrid","pasvaz.bindonce","infinite-scroll"]).config(["$routeProvider","$locationProvider",function(e,t){e.when("/",{templateUrl:"views/givit-list.html",controller:"GivitListCtrl"}).when("/givit-list",{templateUrl:"views/givit-list.html",controller:"GivitListCtrl"}).when("/donate-item",{templateUrl:"views/donate-item.html",controller:"DonateItemCtrl"}).when("/user-details",{templateUrl:"views/user-details.html",controller:"UserDetailsCtrl"}).when("/about",{templateUrl:"views/about.html",controller:"AboutCtrl"}).otherwise({redirectTo:"/"}),t.html5Mode(!1)}]).run(function(){FastClick.attach(document.body),$(document).on("show.bs.collapse",".nav-drawer",function(){var e=$(".navbar-header .navbar-toggle .fa-bars",$(this).parent().parent());e.css("left","-25px")}).on("hide.bs.collapse",".nav-drawer",function(){var e=$(".navbar-header .navbar-toggle .fa-bars",$(this).parent().parent());e.css("left","-15px")}),document.addEventListener("backbutton",function(e){console.log(e);var t=$(".nav-drawer");t.hasClass("in")&&(e.preventDefault(),t.collapse("hide"))},!1)}),angular.module("givitApp").controller("MainCtrl",function(e){e.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}),angular.module("givitApp").directive("actionBar",function(){return{restrict:"E",templateUrl:"views/actionbar.html"}}),angular.module("givitApp").directive("navDrawer",function(){return{templateUrl:"views/navdrawer.html",restrict:"E"}}),angular.module("givitApp").controller("NavDrawerCtrl",function(e,t){e.user=t.$storage.userDetails,e.hide=function(){$(".nav-drawer").collapse("hide")}}),angular.module("givitApp").controller("AboutCtrl",function(e){e.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}),angular.module("givitApp").controller("DonateItemCtrl",function(e){e.item={}}),angular.module("givitApp").controller("UserDetailsCtrl",function(e,t){e.user=t.$storage.userDetails}),angular.module("givitApp").controller("GivitListCtrl",function(e,t,i,n){t.filter=i.$storage.givitListSearch,t.items=n.$storage.cachedItems,t.isLoadingItems=!1,t.pageNumber=1,t.$watch(function(){return i.$storage.givitListSearch},function(e){t.filter=e}),t.$watch(function(){return n.$storage.cachedItems},function(e){t.items=e}),t.clearSearch=function(e){i.$storage.givitListSearch={},t.hideSearch(),e.preventDefault()},t.search=function(){t.pageNumber=1,t.hideSearch(),t.loadItems("set")},t.hideSearch=function(){$("#givit-list-search-form-container").collapse("hide")},t.loadItems=function(e){e=e||"set",t.isLoadingItems=!0,n.getItems({pageNumber:t.pageNumber++,fPostcode:t.filter.postcode,fWithinKm:t.filter.km},e).then(function(){t.isLoadingItems=!1})},t.hideItem=function(e,i){$(i.target.parentNode.parentNode).addClass("animated fadeOutUp").one("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend",function(){n.hideItem(e),t.$apply()})},t.getDeliveryMethods=function(e){return n.getDeliveryMethodsMarkup(e)},t.selectGivitItem=function(t){e.$broadcast("selectGivitItem",t)},_.isEmpty(t.items)&&t.loadItems()}),angular.module("givitApp").controller("TermsOfParticipationCtrl",function(e,t,i){e.scrollTo=function(e){var n=t.hash();t.hash(e),i(),t.hash(n)}}),angular.module("givitApp").service("GivitApi",function(){this.url="http://givitapi.brownpaperbag.com.au/"}),angular.module("givitApp").service("User",function(e){this.$storage=e,this.$storage.$default({userDetails:{},givitListSearch:{postcode:"",km:0},showIntro:!0}),this.setUserDetails=function(e){this.$storage.userDetails=e},this.clear=function(e){delete this.$storage[e]}}),angular.module("givitApp").service("Items",function(e,t,i){function n(e){return _.map(e,function(e){return e.DeliveryMethods=[],_.each({"Pick Up":e.CharityCanPickUp,"Drop Off":e.DonorCanDropOff,Post:e.DonorCanPost},function(t,i){t&&e.DeliveryMethods.push(i)}),{GUID:e.GUID,ItemName:e.ItemName,Location:e.Location,NumberDonationsRequried:e.NumberDonationsRequried,QuantityReserved:e.QuantityReserved,Recipient:e.Recipient,RecipientDescription:e.RecipientDescription,HasImg:!1,DeliveryMethods:e.DeliveryMethods}})}this.$storage=e,this.$storage.$default({cachedItems:[],hiddenItems:[]}),this.getDeliveryMethodsMarkup=function(e){var t="",i={"Pick Up":"fa-home","Drop Off":"fa-truck",Post:"fa-dropbox"};return _.each(e,function(e){t+='<span class="delivery-method"><i class="fa '+i[e]+'" />'+e+"</span>"}),t},this.rejectHiddenItems=function(e){var t=this.$storage.hiddenItems;return _.reject(e,function(e){return _.contains(t,e.GUID)})},this.getItems=function(e,r){e=e||{},r=r||"set",_.defaults(e,{pageNumber:1,rowsPerPage:15,fItemName:"",fPostOnly:!1,fPostcode:"",fWithinKm:0});var a=function(e){var t=e.data.Data;t=this.rejectHiddenItems(n(t)),"set"===r?this.setCachedItems(t):this.addItemsToCache(t)};return t({method:"GET",url:i.url+"givit-list",params:e}).then(a.bind(this))},this.addItemsToCache=function(e){this.$storage.cachedItems=_.uniq(_.union(this.$storage.cachedItems,e),!1,function(e){return e.GUID})},this.setCachedItems=function(e){this.$storage.cachedItems=e},this.clearCachedItems=function(){delete this.$storage.cachedItems},this.hideItem=function(e){this.$storage.hiddenItems.push(e),this.$storage.cachedItems=_.reject(this.$storage.cachedItems,function(t){return t.GUID===e})}}),angular.module("givitApp").service("DonateItem",function(){}),angular.module("givitApp").controller("ActionBarCtrl",function(e,t){e.isSearchShown=!1,e.showGivitListSearch=function(){e.isSearchShown=!e.isSearchShown},e.currentRouteIs=function(e){return"string"==typeof e&&(e=[e]),e.indexOf(t.current.templateUrl)>-1}}),angular.module("givitApp").controller("GiveItemCtrl",function(e,t,i){e.item=null,e.getDeliveryMethods=function(){var t=e.item&&e.item.DeliveryMethods;return t?i.getDeliveryMethodsMarkup(t):void 0},e.$on("selectGivitItem",function(t,n){e.item=_.find(i.$storage.cachedItems,function(e){return e.GUID===n})})});